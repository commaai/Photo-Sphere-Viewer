{"version":3,"file":"stereo.js","sources":["../../src/plugins/stereo/constants.js","../../src/plugins/stereo/StereoButton.js","../../src/plugins/stereo/StereoEffect.js","../../src/plugins/stereo/index.js"],"sourcesContent":["/**\n * @summary Available events\n * @enum {string}\n * @memberof PSV.plugins.StereoPlugin\n * @constant\n */\nexport const EVENTS = {\n  /**\n   * @event stereo-updated\n   * @memberof PSV.plugins.StereoPlugin\n   * @summary Triggered when the stereo view is enabled/disabled\n   * @param {boolean} enabled\n   */\n  STEREO_UPDATED: 'stereo-updated',\n};\n\n/**\n * @type {string}\n * @constant\n * @private\n */\nexport const ID_OVERLAY_PLEASE_ROTATE = 'pleaseRotate';\n","import { AbstractButton } from '../..';\nimport { EVENTS } from './constants';\nimport stereo from './stereo.svg';\n\n/**\n * @summary Navigation bar stereo button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class StereoButton extends AbstractButton {\n\n  static id = 'stereo';\n  static icon = stereo;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-stereo-button', true);\n\n    /**\n     * @type {PSV.plugins.StereoPlugin}\n     * @private\n     * @readonly\n     */\n    this.plugin = this.psv.getPlugin('stereo');\n\n    if (this.plugin) {\n      this.plugin.on(EVENTS.STEREO_UPDATED, this);\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    if (this.plugin) {\n      this.plugin.off(EVENTS.STEREO_UPDATED, this);\n    }\n\n    delete this.plugin;\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !this.plugin ? false : { initial: false, promise: this.plugin.prop.isSupported };\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    if (e.type === EVENTS.STEREO_UPDATED) {\n      this.toggleActive(e.args[0]);\n    }\n  }\n\n  /**\n   * @override\n   * @description Toggles stereo control\n   */\n  onClick() {\n    this.plugin.toggle();\n  }\n\n}\n","import {\n\tStereoCamera,\n\tVector2\n} from 'three';\n\n/**\n * Copied from three.js examples\n * @private\n */\nclass StereoEffect {\n\n\tconstructor( renderer ) {\n\n\t\tconst _stereo = new StereoCamera();\n\t\t_stereo.aspect = 0.5;\n\t\tconst size = new Vector2();\n\n\t\tthis.setEyeSeparation = function ( eyeSep ) {\n\n\t\t\t_stereo.eyeSep = eyeSep;\n\n\t\t};\n\n\t\tthis.setSize = function ( width, height ) {\n\n\t\t\trenderer.setSize( width, height );\n\n\t\t};\n\n\t\tthis.render = function ( scene, camera ) {\n\n\t\t\tscene.updateMatrixWorld();\n\n\t\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\n\n\t\t\t_stereo.update( camera );\n\n\t\t\trenderer.getSize( size );\n\n\t\t\tif ( renderer.autoClear ) renderer.clear();\n\t\t\trenderer.setScissorTest( true );\n\n\t\t\trenderer.setScissor( 0, 0, size.width / 2, size.height );\n\t\t\trenderer.setViewport( 0, 0, size.width / 2, size.height );\n\t\t\trenderer.render( scene, _stereo.cameraL );\n\n\t\t\trenderer.setScissor( size.width / 2, 0, size.width / 2, size.height );\n\t\t\trenderer.setViewport( size.width / 2, 0, size.width / 2, size.height );\n\t\t\trenderer.render( scene, _stereo.cameraR );\n\n\t\t\trenderer.setScissorTest( false );\n\n\t\t};\n\n\t}\n\n}\n\nexport { StereoEffect };\n","import { AbstractPlugin, CONSTANTS, DEFAULTS, PSVError, registerButton, utils } from '../..';\nimport { EVENTS, ID_OVERLAY_PLEASE_ROTATE } from './constants';\nimport mobileRotateIcon from './mobile-rotate.svg';\nimport { StereoButton } from './StereoButton';\nimport { StereoEffect } from './StereoEffect';\n\n\n/**\n * @external NoSleep\n * @description {@link https://github.com/richtr/NoSleep.js}\n */\n\n\n// add stereo button\nDEFAULTS.lang[StereoButton.id] = 'Stereo view';\nregisterButton(StereoButton, 'caption:right');\n\n// other lang strings\nDEFAULTS.lang.stereoNotification = 'Tap anywhere to exit stereo view.';\nDEFAULTS.lang.pleaseRotate = ['Please rotate your device', '(or tap to continue)'];\n\n\nexport { EVENTS } from './constants';\n\n\n/**\n * @summary Adds stereo view on mobile devices\n * @extends PSV.plugins.AbstractPlugin\n * @memberof PSV.plugins\n */\nexport class StereoPlugin extends AbstractPlugin {\n\n  static id = 'stereo';\n\n  static EVENTS = EVENTS;\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv);\n\n    /**\n     * @type {PSV.plugins.GyroscopePlugin}\n     * @readonly\n     * @private\n     */\n    this.gyroscope = null;\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin}\n     * @readonly\n     * @private\n     */\n    this.markers = null;\n\n    /**\n     * @type {PSV.plugins.CompassPlugin}\n     * @readonly\n     * @private\n     */\n    this.compass = null;\n\n    /**\n     * @member {Object}\n     * @protected\n     * @property {Promise<boolean>} isSupported - indicates of the gyroscope API is available\n     * @property {external:THREE.WebGLRenderer} renderer - original renderer\n     * @property {external:NoSleep} noSleep\n     * @property {WakeLockSentinel} wakeLock\n     */\n    this.prop = {\n      isSupported: false,\n      renderer   : null,\n      noSleep    : null,\n      wakeLock   : null,\n    };\n  }\n\n  /**\n   * @package\n   */\n  init() {\n    super.init();\n\n    this.markers = this.psv.getPlugin('markers');\n    this.compass = this.psv.getPlugin('compass');\n    this.gyroscope = this.psv.getPlugin('gyroscope');\n\n    if (!this.gyroscope) {\n      throw new PSVError('Stereo plugin requires the Gyroscope plugin');\n    }\n\n    this.prop.isSupported = this.gyroscope.prop.isSupported;\n\n    this.psv.on(CONSTANTS.EVENTS.STOP_ALL, this);\n    this.psv.on(CONSTANTS.EVENTS.CLICK, this);\n  }\n\n  /**\n   * @package\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.STOP_ALL, this);\n    this.psv.off(CONSTANTS.EVENTS.CLICK, this);\n\n    this.stop();\n\n    delete this.markers;\n    delete this.compass;\n    delete this.gyroscope;\n\n    super.destroy();\n  }\n\n  /**\n   * @private\n   */\n  handleEvent(e) {\n    switch (e.type) {\n      case CONSTANTS.EVENTS.STOP_ALL:\n      case CONSTANTS.EVENTS.CLICK:\n        this.stop();\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * @summary Checks if the stereo view is enabled\n   * @returns {boolean}\n   */\n  isEnabled() {\n    return !!this.prop.renderer;\n  }\n\n  /**\n   * @summary Enables the stereo view\n   * @description\n   *  - enables NoSleep.js\n   *  - enables full screen\n   *  - starts gyroscope controle\n   *  - hides markers, navbar and panel\n   *  - instanciate {@link external:THREE.StereoEffect}\n   * @returns {Promise}\n   * @fires PSV.plugins.StereoPlugin.stereo-updated\n   * @throws {PSV.PSVError} if the gyroscope API is not available/granted\n   */\n  start() {\n    // Need to be in the main event queue\n    this.psv.enterFullscreen();\n    this.__startNoSleep();\n    this.__lockOrientation();\n\n    return this.gyroscope.start().then(() => {\n      // switch renderer\n      this.prop.renderer = this.psv.renderer.renderer;\n      this.psv.renderer.renderer = new StereoEffect(this.psv.renderer.renderer);\n\n      this.psv.needsUpdate();\n\n      this.markers?.hide();\n      this.compass?.hide();\n      this.psv.navbar.hide();\n      this.psv.panel.hide();\n\n      this.trigger(EVENTS.STEREO_UPDATED, true);\n\n      this.psv.notification.show({\n        content: this.psv.config.lang.stereoNotification,\n        timeout: 3000,\n      });\n    }, () => {\n      this.__unlockOrientation();\n      this.__stopNoSleep();\n      this.psv.exitFullscreen();\n    });\n  }\n\n  /**\n   * @summary Disables the stereo view\n   * @fires PSV.plugins.StereoPlugin.stereo-updated\n   */\n  stop() {\n    if (this.isEnabled()) {\n      this.psv.renderer.renderer = this.prop.renderer;\n      this.prop.renderer = null;\n\n      this.psv.needsUpdate();\n\n      this.markers?.show();\n      this.compass?.show();\n      this.psv.navbar.show();\n\n      this.__unlockOrientation();\n      this.__stopNoSleep();\n      this.psv.exitFullscreen();\n      this.gyroscope.stop();\n\n      this.trigger(EVENTS.STEREO_UPDATED, false);\n    }\n  }\n\n  /**\n   * @summary Enables or disables the stereo view\n   */\n  toggle() {\n    if (this.isEnabled()) {\n      this.stop();\n    }\n    else {\n      this.start();\n    }\n  }\n\n  /**\n   * @summary Enables WakeLock or NoSleep.js\n   * @private\n   */\n  __startNoSleep() {\n    if ('wakeLock' in navigator) {\n      navigator.wakeLock.request('screen')\n        .then((wakeLock) => {\n          this.prop.wakeLock = wakeLock;\n        })\n        .catch(() => utils.logWarn('Cannot acquire WakeLock'));\n    }\n    else if ('NoSleep' in window) {\n      if (!this.prop.noSleep) {\n        this.prop.noSleep = new window.NoSleep();\n      }\n      this.prop.noSleep.enable();\n    }\n    else {\n      utils.logWarn('NoSleep is not available');\n    }\n  }\n\n  /**\n   * @summary Disables WakeLock or NoSleep.js\n   * @private\n   */\n  __stopNoSleep() {\n    if (this.prop.wakeLock) {\n      this.prop.wakeLock.release();\n      this.prop.wakeLock = null;\n    }\n    else if (this.prop.noSleep) {\n      this.prop.noSleep.disable();\n    }\n  }\n\n  /**\n   * @summary Tries to lock the device in landscape or display a message\n   * @private\n   */\n  __lockOrientation() {\n    let displayRotateMessageTimeout;\n\n    const displayRotateMessage = () => {\n      if (window.innerHeight > window.innerWidth) {\n        this.psv.overlay.show({\n          id     : ID_OVERLAY_PLEASE_ROTATE,\n          image  : mobileRotateIcon,\n          text   : this.psv.config.lang.pleaseRotate[0],\n          subtext: this.psv.config.lang.pleaseRotate[1],\n        });\n      }\n\n      if (displayRotateMessageTimeout) {\n        clearTimeout(displayRotateMessageTimeout);\n        displayRotateMessageTimeout = null;\n      }\n    };\n\n    if (window.screen?.orientation) {\n      window.screen.orientation.lock('landscape').then(null, () => displayRotateMessage());\n      displayRotateMessageTimeout = setTimeout(() => displayRotateMessage(), 500);\n    }\n    else {\n      displayRotateMessage();\n    }\n  }\n\n  /**\n   * @summary Unlock the device orientation\n   * @private\n   */\n  __unlockOrientation() {\n    if (window.screen?.orientation) {\n      window.screen.orientation.unlock();\n    }\n    else {\n      this.psv.overlay.hide(ID_OVERLAY_PLEASE_ROTATE);\n    }\n  }\n\n}\n"],"names":["EVENTS","STEREO_UPDATED","ID_OVERLAY_PLEASE_ROTATE","StereoButton","navbar","plugin","psv","getPlugin","on","destroy","off","isSupported","initial","promise","prop","handleEvent","e","type","toggleActive","args","onClick","toggle","AbstractButton","id","icon","stereo","StereoEffect","renderer","_stereo","StereoCamera","aspect","size","Vector2","setEyeSeparation","eyeSep","setSize","width","height","render","scene","camera","updateMatrixWorld","parent","update","getSize","autoClear","clear","setScissorTest","setScissor","setViewport","cameraL","cameraR","DEFAULTS","lang","registerButton","stereoNotification","pleaseRotate","StereoPlugin","gyroscope","markers","compass","noSleep","wakeLock","init","PSVError","CONSTANTS","STOP_ALL","CLICK","stop","isEnabled","start","enterFullscreen","__startNoSleep","__lockOrientation","then","needsUpdate","hide","panel","trigger","notification","show","content","config","timeout","__unlockOrientation","__stopNoSleep","exitFullscreen","navigator","request","catch","utils","logWarn","window","NoSleep","enable","release","disable","displayRotateMessageTimeout","displayRotateMessage","innerHeight","innerWidth","overlay","image","mobileRotateIcon","text","subtext","clearTimeout","screen","orientation","lock","setTimeout","unlock","AbstractPlugin"],"mappings":"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"}