{"version":3,"file":"gallery.js","sources":["../../src/plugins/gallery/constants.js","../../src/plugins/gallery/GalleryButton.js","../../src/plugins/gallery/GalleryComponent.js","../../src/plugins/gallery/index.js"],"sourcesContent":["import { utils } from '../..';\n\n/**\n * @summary Available events\n * @enum {string}\n * @memberof PSV.plugins.GalleryPlugin\n * @constant\n */\nexport const EVENTS = {\n  /**\n   * @event show-gallery\n   * @memberof PSV.plugins.GalleryPlugin\n   * @summary Triggered when the gallery is shown\n   */\n  SHOW_GALLERY: 'show-gallery',\n  /**\n   * @event hide-gallery\n   * @memberof PSV.plugins.GalleryPlugin\n   * @summary Triggered when the gallery is hidden\n   */\n  HIDE_GALLERY: 'hide-gallery',\n};\n\n/**\n * @summary Property name added to gallery items\n * @type {string}\n * @constant\n * @private\n */\nexport const GALLERY_ITEM_DATA = 'psvGalleryItem';\n\n/**\n * @summary Property name added to gallery items (dash-case)\n * @type {string}\n * @constant\n * @private\n */\nexport const GALLERY_ITEM_DATA_KEY = utils.dasherize(GALLERY_ITEM_DATA);\n\n/**\n * @summary Gallery template\n * @param {PSV.plugins.GalleryPlugin.Item[]} items\n * @param {PSV.Size} size\n * @returns {string}\n * @constant\n * @private\n */\nexport const ITEMS_TEMPLATE = (items, size) => `\n<div class=\"psv-gallery-container\">\n  ${items.map(item => `\n  <div class=\"psv-gallery-item\" data-${GALLERY_ITEM_DATA_KEY}=\"${item.id}\" style=\"width:${size.width}px\">\n    <div class=\"psv-gallery-item-wrapper\" style=\"padding-bottom:calc(100% * ${size.height} / ${size.width})\">\n      ${item.name ? `<div class=\"psv-gallery-item-title\"><span>${item.name}</span></div>` : ''}\n      <svg class=\"psv-gallery-item-thumb\" viewBox=\"0 0 200 200\" preserveAspectRatio=\"xMidYMid slice\"><use href=\"#psvGalleryBlankIcon\"></use></svg>\n      ${item.thumbnail ? `<div class=\"psv-gallery-item-thumb\" data-src=\"${item.thumbnail}\"></div>` : ''}\n    </div>\n  </div>\n  `).join('')}\n</div>\n`;\n","import { AbstractButton } from '../..';\nimport { EVENTS } from './constants';\nimport gallery from './gallery.svg';\n\n/**\n * @summary Navigation bar gallery button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class GalleryButton extends AbstractButton {\n\n  static id = 'gallery';\n  static icon = gallery;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-gallery-button', true);\n\n    /**\n     * @type {PSV.plugins.GalleryPlugin}\n     * @readonly\n     * @private\n     */\n    this.plugin = this.psv.getPlugin('gallery');\n\n    if (this.plugin) {\n      this.plugin.on(EVENTS.SHOW_GALLERY, this);\n      this.plugin.on(EVENTS.HIDE_GALLERY, this);\n    }\n\n    if (!this.plugin?.items.length) {\n      this.hide();\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    if (this.plugin) {\n      this.plugin.off(EVENTS.SHOW_GALLERY, this);\n      this.plugin.off(EVENTS.HIDE_GALLERY, this);\n    }\n\n    delete this.plugin;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    if (e.type === EVENTS.SHOW_GALLERY) {\n      this.toggleActive(true);\n    }\n    else if (e.type === EVENTS.HIDE_GALLERY) {\n      this.toggleActive(false);\n    }\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !!this.plugin;\n  }\n\n  /**\n   * @override\n   * @description Toggles gallery\n   */\n  onClick() {\n    this.plugin.toggle();\n  }\n\n}\n","import { AbstractComponent, SYSTEM, utils } from '../..';\nimport blankIcon from './blank.svg';\nimport { GALLERY_ITEM_DATA, GALLERY_ITEM_DATA_KEY, ITEMS_TEMPLATE } from './constants';\n\nconst ACTIVE_CLASS = 'psv-gallery-item--active';\n\n/**\n * @private\n */\nexport class GalleryComponent extends AbstractComponent {\n\n  constructor(plugin) {\n    super(plugin.psv, 'psv-gallery psv--capture-event');\n\n    /**\n     * @type {SVGElement}\n     * @private\n     * @readonly\n     */\n    this.blankIcon = (() => {\n      const temp = document.createElement('div');\n      temp.innerHTML = blankIcon;\n      return temp.firstChild;\n    })();\n    this.blankIcon.style.display = 'none';\n    this.psv.container.appendChild(this.blankIcon);\n\n    if ('IntersectionObserver' in window) {\n      /**\n       * @type {IntersectionObserver}\n       * @private\n       * @readonly\n       */\n      this.observer = new IntersectionObserver((entries) => {\n        entries.forEach((entry) => {\n          if (entry.intersectionRatio > 0) {\n            entry.target.style.backgroundImage = `url(${entry.target.dataset.src})`;\n            delete entry.target.dataset.src;\n            this.observer.unobserve(entry.target);\n          }\n        });\n      }, {\n        root: this.psv.container,\n      });\n    }\n\n    /**\n     * @type {PSV.plugins.GalleryPlugin}\n     * @private\n     * @readonly\n     */\n    this.plugin = plugin;\n\n    /**\n     * @type {Object}\n     * @private\n     */\n    this.prop = {\n      ...this.prop,\n      mousedown : false,\n      initMouseX: null,\n      mouseX    : null,\n    };\n\n    this.container.addEventListener(SYSTEM.mouseWheelEvent, this);\n    this.container.addEventListener('mousedown', this);\n    this.container.addEventListener('mousemove', this);\n    this.container.addEventListener('click', this);\n    window.addEventListener('mouseup', this);\n\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.container.removeChild(this.blankIcon);\n\n    window.removeEventListener('mouseup', this);\n\n    this.observer?.disconnect();\n\n    delete this.plugin;\n    delete this.blankIcon;\n    delete this.observer;\n\n    super.destroy();\n  }\n\n  /**\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      case SYSTEM.mouseWheelEvent:\n        const spinY = utils.normalizeWheel(e).spinY;\n        this.container.scrollLeft += spinY * 50;\n        e.preventDefault();\n        break;\n\n      case 'mousedown':\n        this.prop.mousedown = true;\n        this.prop.initMouseX = e.clientX;\n        this.prop.mouseX = e.clientX;\n        break;\n\n      case 'mousemove':\n        if (this.prop.mousedown) {\n          const delta = this.prop.mouseX - e.clientX;\n          this.container.scrollLeft += delta;\n          this.prop.mouseX = e.clientX;\n        }\n        break;\n\n      case 'mouseup':\n        this.prop.mousedown = false;\n        this.prop.mouseX = null;\n        e.preventDefault();\n        break;\n\n      case 'click':\n        // prevent click on drag\n        if (Math.abs(this.prop.initMouseX - e.clientX) < 10) {\n          const item = utils.getClosest(e.target, `[data-${GALLERY_ITEM_DATA_KEY}]`);\n          if (item) {\n            this.plugin.__click(item.dataset[GALLERY_ITEM_DATA]);\n          }\n        }\n        break;\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   */\n  show() {\n    this.container.classList.add('psv-gallery--open');\n    this.prop.visible = true;\n  }\n\n  /**\n   * @override\n   */\n  hide() {\n    this.container.classList.remove('psv-gallery--open');\n    this.prop.visible = false;\n  }\n\n  /**\n   * @summary Sets the list of items\n   * @param {PSV.plugins.GalleryPlugin.Item[]} items\n   */\n  setItems(items) {\n    this.container.innerHTML = ITEMS_TEMPLATE(items, this.plugin.config.thumbnailSize);\n\n    if (this.observer) {\n      this.observer.disconnect();\n\n      for (const child of this.container.querySelectorAll('[data-src]')) {\n        this.observer.observe(child);\n      }\n    }\n  }\n\n  /**\n   * @param {number | string} id\n   */\n  setActive(id) {\n    const currentActive = this.container.querySelector('.' + ACTIVE_CLASS);\n    currentActive?.classList.remove(ACTIVE_CLASS);\n\n    if (id) {\n      const nextActive = this.container.querySelector(`[data-${GALLERY_ITEM_DATA_KEY}=\"${id}\"]`);\n      nextActive?.classList.add(ACTIVE_CLASS);\n    }\n  }\n\n}\n","import { AbstractPlugin, CONSTANTS, DEFAULTS, PSVError, registerButton, utils } from '../..';\nimport { EVENTS } from './constants';\nimport { GalleryButton } from './GalleryButton';\nimport { GalleryComponent } from './GalleryComponent';\nimport './style.scss';\n\n/**\n * @typedef {Object} PSV.plugins.GalleryPlugin.Item\n * @property {number|string} id - Unique identifier of the item\n * @property {*} panorama\n * @property {string} [thumbnail] - URL of the thumbnail\n * @property {string} [name] - Text visible over the thumbnail\n * @property {PSV.PanoramaOptions} [options] - Any option supported by the `setPanorama()` method\n */\n\n/**\n * @typedef {Object} PSV.plugins.GalleryPlugin.Options\n * @property {PSV.plugins.GalleryPlugin.Item[]} [items]\n * @property {boolean} [visibleOnLoad=false] - Displays the gallery when loading the first panorama\n * @property {boolean} [hideOnClick=true] - Hides the gallery when the user clicks on an item\n * @property {PSV.Size} [thumbnailSize] - Size of thumbnails, default (200x100) is set with CSS\n */\n\n\n// add gallery button\nDEFAULTS.lang[GalleryButton.id] = 'Gallery';\nregisterButton(GalleryButton, 'caption:left');\n\n\nexport { EVENTS } from './constants';\n\n\n/**\n * @summary Adds a gallery of multiple panoramas\n * @extends PSV.plugins.AbstractPlugin\n * @memberof PSV.plugins\n */\nexport class GalleryPlugin extends AbstractPlugin {\n\n  static id = 'gallery';\n\n  static EVENTS = EVENTS;\n\n  /**\n   * @param {PSV.Viewer} psv\n   * @param {PSV.plugins.GalleryPlugin.Options} options\n   */\n  constructor(psv, options) {\n    super(psv);\n\n    /**\n     * @member {PSV.plugins.GalleryPlugin.Options}\n     * @private\n     */\n    this.config = {\n      items        : null,\n      visibleOnLoad: false,\n      hideOnClick  : true,\n      thumbnailSize: {\n        width : 200,\n        height: 100,\n      },\n      ...options,\n    };\n\n    /**\n     * @type {Object}\n     * @private\n     */\n    this.prop = {\n      handler  : null,\n      currentId: null,\n    };\n\n    /**\n     * @type {GalleryComponent}\n     * @private\n     * @readonly\n     */\n    this.gallery = new GalleryComponent(this);\n\n    /**\n     * @type {PSV.plugins.GalleryPlugin.Item[]}\n     * @private\n     */\n    this.items = [];\n  }\n\n  /**\n   * @package\n   */\n  init() {\n    super.init();\n\n    this.psv.on(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n\n    if (this.config.visibleOnLoad) {\n      this.psv.once(CONSTANTS.EVENTS.READY, () => {\n        this.show();\n      });\n    }\n\n    this.setItems(this.config.items);\n    delete this.config.items;\n  }\n\n  /**\n   * @package\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n\n    this.gallery.destroy();\n\n    super.destroy();\n  }\n\n  /**\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      case CONSTANTS.EVENTS.PANORAMA_LOADED:\n        const item = this.items.find(i => utils.deepEqual(i.panorama, e.args[0].panorama));\n        this.prop.currentId = item?.id;\n        this.gallery.setActive(item?.id);\n        break;\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @summary Shows the gallery\n   * @fires PSV.plugins.GalleryPlugin.show-gallery\n   */\n  show() {\n    this.trigger(EVENTS.SHOW_GALLERY);\n    return this.gallery.show();\n  }\n\n  /**\n   * @summary Hides the carousem\n   * @fires PSV.plugins.GalleryPlugin.hide-gallery\n   */\n  hide() {\n    this.trigger(EVENTS.HIDE_GALLERY);\n    return this.gallery.hide();\n  }\n\n  /**\n   * @summary Hides or shows the gallery\n   */\n  toggle() {\n    if (this.gallery.isVisible()) {\n      this.hide();\n    }\n    else {\n      this.show();\n    }\n  }\n\n  /**\n   * @summary Sets the list of items\n   * @param {PSV.plugins.GalleryPlugin.Item[]} items\n   * @param {function} [handler] function that will be called when an item is clicked instead of the default behavior\n   */\n  setItems(items, handler) {\n    if (!items?.length) {\n      items = [];\n    }\n    else {\n      items.forEach((item, i) => {\n        if (!item.id) {\n          throw new PSVError(`Item ${i} has no \"id\".`);\n        }\n        if (!item.panorama) {\n          throw new PSVError(`Item ${item.id} has no \"panorama\".`);\n        }\n      });\n    }\n\n    this.prop.handler = handler;\n    this.items = items.map(item => ({\n      ...item,\n      id: `${item.id}`,\n    }));\n\n    this.gallery.setItems(this.items);\n\n    this.psv.navbar.getButton(GalleryButton.id, false)?.toggle(this.items.length > 0);\n  }\n\n  /**\n   * @param {string} id\n   * @package\n   */\n  __click(id) {\n    if (id === this.prop.currentId) {\n      return;\n    }\n\n    if (this.prop.handler) {\n      this.prop.handler(id);\n    }\n    else {\n      const item = this.items.find(i => i.id === id);\n      this.psv.setPanorama(item.panorama, {\n        caption: item.name,\n        ...item.options,\n      });\n    }\n\n    this.prop.currentId = id;\n    this.gallery.setActive(id);\n\n    if (this.config.hideOnClick) {\n      this.hide();\n    }\n  }\n\n}\n"],"names":["EVENTS","SHOW_GALLERY","HIDE_GALLERY","GALLERY_ITEM_DATA","GALLERY_ITEM_DATA_KEY","utils","dasherize","ITEMS_TEMPLATE","items","size","map","item","id","width","height","name","thumbnail","join","GalleryButton","navbar","plugin","psv","getPlugin","on","length","hide","destroy","off","handleEvent","e","type","toggleActive","isSupported","onClick","toggle","AbstractButton","icon","gallery","ACTIVE_CLASS","GalleryComponent","blankIcon","temp","document","createElement","innerHTML","firstChild","style","display","container","appendChild","window","observer","IntersectionObserver","entries","forEach","entry","intersectionRatio","target","backgroundImage","dataset","src","unobserve","root","prop","mousedown","initMouseX","mouseX","addEventListener","SYSTEM","mouseWheelEvent","removeChild","removeEventListener","disconnect","spinY","normalizeWheel","scrollLeft","preventDefault","clientX","delta","Math","abs","getClosest","__click","show","classList","add","visible","remove","setItems","config","thumbnailSize","querySelectorAll","child","observe","setActive","currentActive","querySelector","nextActive","AbstractComponent","DEFAULTS","lang","registerButton","GalleryPlugin","options","visibleOnLoad","hideOnClick","handler","currentId","init","CONSTANTS","PANORAMA_LOADED","once","READY","find","i","deepEqual","panorama","args","trigger","isVisible","PSVError","getButton","setPanorama","caption","AbstractPlugin"],"mappings":"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"}